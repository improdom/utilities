try
{
    var _benchmark = (BenchmarkEntity)this.TabManager.SelectedTab.Tag as BenchmarkEntity;
    if (_benchmark == null)
        return;

    using var db = new DatabaseContext();

    var originalBenchmarkSettings = new BenchmarkSettings
    {
        Benchmark = _benchmark,
        Queries = (from q in db.QueryEntities
                   where q.BenchmarkId == _benchmark.BenchmarkId
                   select q.Id).ToList(),
        Parameters = (from p in db.Parameters.ToList()
                      join q in db.QueryEntities
                      on p.QueryId equals q.Id
                      where p.BenchmarkId == _benchmark.BenchmarkId
                      select p).Distinct().ToList()
    };

    // Split the queries into chunks of 10
    var splitBenchmarkSettings = SplitQueriesIntoChunks(originalBenchmarkSettings, 10);

    foreach (var benchmarkSettings in splitBenchmarkSettings)
    {
        string content = string.Empty;

        if (Path.GetExtension(saveSettingsFileDialog.FileName) == ".json")
        {
            content = JsonSerializer.WriteFromObject(benchmarkSettings);
        }
        else if (Path.GetExtension(saveSettingsFileDialog.FileName) == ".yaml")
        {
            var serializer = new SerializerBuilder().Build();
            content = serializer.Serialize(benchmarkSettings);
        }

        File.WriteAllText($"{Path.GetFileNameWithoutExtension(saveSettingsFileDialog.FileName)}_{splitBenchmarkSettings.IndexOf(benchmarkSettings)}{Path.GetExtension(saveSettingsFileDialog.FileName)}", content);
    }
}
catch (Exception ex)
{
    MessageBox.Show($"{Resources.ErrorSavingSettings}: {ex.Message}");
}
