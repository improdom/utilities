CREATE TABLE query_readiness (
    query_id UUID PRIMARY KEY,
    query_name TEXT,
    target_node_name TEXT,
    target_node_level TEXT,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE readiness_status (
    query_id UUID NOT NULL,
    subdesk_name TEXT NOT NULL,
    execution_date DATE NOT NULL,
    is_ready BOOLEAN,
    last_updated TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (query_id, subdesk_name, execution_date),
    FOREIGN KEY (query_id) REFERENCES query_readiness(query_id) ON DELETE CASCADE
);


CREATE TABLE query_execution_status (
    query_id UUID NOT NULL,
    execution_date DATE NOT NULL,
    status TEXT,
    last_attempt TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    message TEXT,
    PRIMARY KEY (query_id, execution_date),
    FOREIGN KEY (query_id) REFERENCES query_readiness(query_id) ON DELETE CASCADE
);


CREATE TABLE query_execution_log (
    execution_id UUID PRIMARY KEY,
    query_id UUID NOT NULL,
    execution_time TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    success BOOLEAN,
    message TEXT,
    FOREIGN KEY (query_id) REFERENCES query_readiness(query_id) ON DELETE CASCADE
);
